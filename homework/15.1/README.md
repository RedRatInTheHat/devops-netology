## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определённых данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- электронные чеки в json-виде,
- склады и автомобильные дороги для логистической компании,
- генеалогические деревья,
- кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации,
- отношения клиент-покупка для интернет-магазина.

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

## Решение 1

#### Электронные чеки в json-виде

Подойдёт документоориентированная NoSQL СУБД, вроде MongoDB – такая структура как раз позволит хранить документы с более-менее произвольным содержимым.

#### Склады и автомобильные дороги для логистической компании

Зависит от того, что нам важнее – строить маршрут или просто получать информацию о том, что где находится, какие характеристики у дороги/склада и как они связаны.

В первом случае подойдёт графовая СУБД, во втором – реляционная.

#### Генеалогические деревья

В генеалогических деревьях главное – связи.

Связи хорошо отображаются в реляционных СУБД и ещё лучше – в NoSQL графовых СУБД.

#### Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации

Для работы с кэшом используются – а некоторые изначально для этого и предназначались – NoSQL СУБД типа "ключ-значение", вроде Redis или Memcached. Они хранят данные в оперативной памяти, так что позволят производить операцию достаточно быстро, и как минимум некоторые из них обладают разнообразными механизмами TTL.

#### Отношения клиент-покупка для интернет-магазина

Тут по определению нужны реляционные СУБД и их возможностью создавать связи между таблицами и структурировать данные.

---

## Задача 2

Вы создали распределённое высоконагруженное приложение и хотите классифицировать его согласно CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если (каждый пункт — это отдельная реализация вашей системы и для каждого пункта нужно привести классификацию):

- данные записываются на все узлы с задержкой до часа (асинхронная запись);
- при сетевых сбоях система может разделиться на 2 раздельных кластера;
- система может не прислать корректный ответ или сбросить соединение.

Согласно PACELC-теореме как бы вы классифицировали эти реализации?

## Решение 2

#### Данные записываются на все узлы с задержкой до часа (асинхронная запись)

Предположим, что при такой задержке мы не хотим ждать, пока данные запишутся на все узлы, и жертвуем согласованностью. Тогда:

 * в CAP – AP (availability, partition tolerance). Данные рано или поздно записываются, но не гарантируется, что они будут в любой момент времени согласованы.
 * в PACELS – PA/EL (availability AND latency). В любом случае ставка на доступность и скорость доступа.

 #### При сетевых сбоях система может разделиться на 2 раздельных кластера

Тем более не идёт речь о concictency. Тут так же:

 * в CAP – AP (availability, partition tolerance). Данные рано или поздно записываются, но не гарантируется, что они будут в любой момент времени согласованы.
 * в PACELS – PA/EL (availability AND latency). В любом случае ставка на доступность и скорость доступа.

#### Система может не прислать корректный ответ или сбросить соединение

Сброс соединения говорит нам, что данные неконсистентны и мы ждём, когда они согласуются между узлами. Получается:

* в CAP – CP (consistency, partition tolerance) или CA (consistensy, availability). БД бдит за согласованностью и не позволяет нам нормально общаться с ней.
* в PACELS – PC/EC (consistency) или PС/EL (consistency, latency). При разделении может пострадать доступность или согласованность. 

---

## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

## Решение 3

Сам по себе BASE был представлен как противоположность ACID, так что вряд ли можно реализовать сразу оба приницпа одновременно (хотя очень хочется). ACID направлен на "безопасность": согласованность и правильность данных, а BASE – на скорость работы в ущерб постоянных согласованности и правильности состояния.

---

## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни,
- реакция на истечение таймаута.

Вы слышали о key-value-хранилище, которое имеет механизм Pub/Sub. 
Что это за система? Какие минусы выбора этой системы?

#### Решение 4

Если говорить о конкретных СУБД, то по описанию сходу попадает Redis, хотя можно поискать другие NoSQL "ключ-значение" системы. Она также отвечает требованиям наличия TTL и возможности создания события по истечении времени жизни.

У Redis есть следующие недостатки:

* Однопоточность.
* Данные хранятся в оперативной памяти, а потому могут быть потеряны. Периодически данные могут дублироваться на диск, но, так как это происходит не постоянно, часть данных всё равно потеряется.
* Из предыдущего пункта вытекает требование к оперативной памяти – её размер должен быть достаточным для запланированных действий.

